---
title: "Projekt SAP"
author: "Pavo Matanović, Karla Baričević, Slavko Boldin"
subtitle: "Tema 2 - Uloga izvoza i uvoza u gospodarstvu"
output:
  pdf_document: default
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
Sys.setlocale(locale = "hr_HR.utf8")
```

# Učitavanje podataka i deskriptivna analiza

Na početku učitavamo podatke i analiziramo kako izgledaju podaci.

```{r}
export.data = read.csv("Export_data.csv", fileEncoding="UTF-8-BOM")
# head(export.data)

import.data = read.csv("Import_data.csv", fileEncoding="UTF-8-BOM")
# head(import.data)

gdp.data = read.csv("GDP_data.csv", fileEncoding="UTF-8-BOM")
# head(gdp.data)

gdp.pc.data = read.csv("GDPpercapita_data.csv", fileEncoding="UTF-8-BOM")
# head(gdp.pc.data)
```

Sljedeći blok koda generira dataframe sa brojem upisanih podataka te brojem procjena među upisanim podacima.

```{r}
export.loc.cnt = export.data %>% group_by(LOCATION) %>%
    summarise(exp_n = n(), exp_est = sum(Flag.Codes == 'E')) %>%
    arrange(desc(exp_n), exp_est)
import.loc.cnt = import.data %>% group_by(LOCATION) %>%
    summarise(imp_n = n(), imp_est = sum(Flag.Codes == 'E')) %>%
    arrange(desc(imp_n), imp_est)
gdp.loc.cnt = gdp.data %>% group_by(LOCATION) %>%
    summarise(gdp_n = n(), gdp_est = sum(Flag.Codes == 'E')) %>%
    arrange(desc(gdp_n), gdp_est)
gdp.pc.loc.cnt = gdp.pc.data %>% group_by(LOCATION) %>%
    summarise(gdp_pc_n = n(), gdp_pc_est = sum(Flag.Codes == 'E')) %>%
    arrange(desc(gdp_pc_n), gdp_pc_est)
loc.cnt = merge(merge(export.loc.cnt, import.loc.cnt), merge(gdp.loc.cnt, gdp.pc.loc.cnt))
knitr::kable(
  head(arrange(loc.cnt,
               desc(loc.cnt[,2]), desc(loc.cnt[,4]), desc(loc.cnt[,6]), desc(loc.cnt[,8]),
               loc.cnt[,3], loc.cnt[,5], loc.cnt[,7], loc.cnt[,9]), 20),
  caption = "Broj podataka za pojedinu državu"
)
```

```{r, include=FALSE}
remove(export.loc.cnt, import.loc.cnt, gdp.loc.cnt, gdp.pc.loc.cnt, loc.cnt)
```

### Odabrane drzave
Odabrali smo USA, Njemačku(DEU) i Grčku(GRC) za analizu.

## Deskriptivna statistika

```{r}
time = 1979:2018
usa = data.frame(year = 1979:2018,
                 export.mln_usd = export.data$Value[export.data$LOCATION == "USA"],
                 import.mln_usd = import.data$Value[import.data$LOCATION == "USA"],
                 gdp.mln_usd = gdp.data$Value[gdp.data$LOCATION == "USA"],
                 gdp.pc.usd_cap = gdp.pc.data$Value[gdp.pc.data$LOCATION == "USA"])
usa$net.trade = usa$export.mln_usd - usa$import.mln_usd
deu = data.frame(year = 1979:2019,
                 export.mln_usd = export.data$Value[export.data$LOCATION == "DEU"],
                 import.mln_usd = import.data$Value[import.data$LOCATION == "DEU"],
                 gdp.mln_usd = gdp.data$Value[gdp.data$LOCATION == "DEU"],
                 gdp.pc.usd_cap = gdp.pc.data$Value[gdp.pc.data$LOCATION == "DEU"])
deu$net.trade = deu$export.mln_usd - deu$import.mln_usd
grc = data.frame(year = 1979:2019,
                 export.mln_usd = export.data$Value[export.data$LOCATION == "GRC"],
                 import.mln_usd = import.data$Value[import.data$LOCATION == "GRC"],
                 gdp.mln_usd = gdp.data$Value[gdp.data$LOCATION == "GRC"],
                 gdp.pc.usd_cap = gdp.pc.data$Value[gdp.pc.data$LOCATION == "GRC"])
grc$net.trade = grc$export.mln_usd - grc$import.mln_usd
```

```{r}
usa = usa %>% mutate(import.mln_usd,
                     import.growth = import.mln_usd - lag(import.mln_usd),
                     import.growth.p = import.growth / lag(import.mln_usd) * 100)
deu = deu %>% mutate(import.mln_usd, 
                     import.growth = import.mln_usd - lag(import.mln_usd),
                     import.growth.p = import.growth / lag(import.mln_usd) * 100)
grc = grc %>% mutate(import.mln_usd,
                     import.growth = import.mln_usd - lag(import.mln_usd),
                     import.growth.p = import.growth / lag(import.mln_usd) * 100)
usa = usa %>% mutate(export.mln_usd, 
                     export.growth = export.mln_usd - lag(export.mln_usd),
                     export.growth.p = export.growth / lag(export.mln_usd) * 100)
deu = deu %>% mutate(export.mln_usd,
                     export.growth = export.mln_usd - lag(export.mln_usd),
                     export.growth.p = export.growth / lag(export.mln_usd) * 100)
grc = grc %>% mutate(export.mln_usd,
                     export.growth = export.mln_usd - lag(export.mln_usd),
                     export.growth.p = export.growth / lag(export.mln_usd) * 100)
usa = usa %>% mutate(gdp.mln_usd,
                     gdp.growth = gdp.mln_usd - lag(gdp.mln_usd),
                     gdp.growth.p = gdp.growth / lag(gdp.mln_usd) * 100)
deu = deu %>% mutate(gdp.mln_usd,
                     gdp.growth = gdp.mln_usd - lag(gdp.mln_usd),
                     gdp.growth.p = gdp.growth / lag(gdp.mln_usd) * 100)
grc = grc %>% mutate(gdp.mln_usd,
                     gdp.growth = gdp.mln_usd - lag(gdp.mln_usd),
                     gdp.growth.p = gdp.growth / lag(gdp.mln_usd) * 100)
usa = usa %>% mutate(gdp.pc.usd_cap,
                     gdp.pc.growth = gdp.pc.usd_cap - lag(gdp.pc.usd_cap),
                     gdp.pc.growth.p = gdp.pc.growth / lag(gdp.pc.usd_cap) * 100)
deu = deu %>% mutate(gdp.pc.usd_cap,
                     gdp.pc.growth = gdp.pc.usd_cap - lag(gdp.pc.usd_cap),
                     gdp.pc.growth.p = gdp.pc.growth / lag(gdp.pc.usd_cap) * 100)
grc = grc %>% mutate(gdp.pc.usd_cap,
                     gdp.pc.growth = gdp.pc.usd_cap - lag(gdp.pc.usd_cap),
                     gdp.pc.growth.p = gdp.pc.growth / lag(gdp.pc.usd_cap) * 100)
# brisemo zadnju opservaciju za deu i grc jer usa nema podatke za 2019.g.
deu = deu[-nrow(deu),]
grc = grc[-nrow(grc),]
```

```{r}
data.all = bind_rows(lapply(c("USA", "DEU", "GRC"), function (x) {
  data.frame(country=x, get(tolower(x)))
}))
data.all$country = factor(data.all$country, levels = c("USA", "DEU", "GRC"))
```

```{r}
summary(usa)
summary(deu)
summary(grc)
```

## Uvoz

Uvozi u mil. USD razlikuju se jako čak i na logaritamskoj skali. Veličine su razmjerne površini države te broju stanovnika.
Za distribucije ukupnog uvoza ne možemo pretpostaviti normalnost, pa nema smisla raditi parametarske testove.

Distribucije postotnog rasta izgledaju normalnije pa ćemo njih uzeti za analizu. Dalje ćemo za postotni rast govoriti samo rast.

```{r fig.height=3}
par(mfrow = c(1, 3), oma = c(0, 0, 2, 0))
hist(usa$import.growth.p, main="USA", xlab="rast %", col="deepskyblue")
hist(deu$import.growth.p, main="DEU", xlab="rast %", col="deepskyblue")
hist(grc$import.growth.p, main="GRC", xlab="rast %", col="deepskyblue")
mtext("Postotni rast uvoza", outer = T, cex = 1.5, font = 2)
```


Distribucije nisu previše zakrivljene i imamo dovoljno podataka da možemo pretpostaviti normalnost distribucije.

Taj zaključak potvrđuju i qq plotovi.

```{r}
qqnorm(usa$import.growth.p)
qqline(usa$import.growth.p, col = "steelblue", lwd = 2)

qqnorm(deu$import.growth.p)
qqline(deu$import.growth.p, col = "steelblue", lwd = 2)

qqnorm(grc$import.growth.p)
qqline(grc$import.growth.p, col = "steelblue", lwd = 2)
```

Odstupanja na krajevima qq plota nam sugeriraju da bi distribucije mogle imati teške repove.

```{r}
ggplot(na.omit(data.all), aes(x=country, y=import.growth.p)) +
  stat_boxplot(geom = "errorbar", width = 0.5) +
  geom_boxplot(aes(fill=country)) +
  labs(title = "Porast uvoza", x="Država", y="Postotak", fill="Država") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))
```

Ovaj plot pokazuje da bi varijable USA i DEU mogle imati istu sredinu.

## Izvoz

```{r}
boxplot(deu$export.mln_usd,
        usa$export.mln_usd,
        grc$export.mln_usd,
        names = c("DEU", "USA", "GRC"), main = "Sredine izvoza",
        col = c("deepskyblue2", "deepskyblue3", "deepskyblue"),
        ylab = "mln USD (log skala)",
        log = "y")
```

Podaci su slični kao i kod uvoza, SAD prednjači i u izvozu u odnosu na Njemačku i Grčku.

```{r}
plot(time, deu$export.growth, type = "h", main = "Rast izvoza (DEU)")
```

Za razliku od uvoza koji linearno raste, izvoz više "osjeća" promjene na tržištu (veće fluktuacije), npr. značajan pad izvoza 2009. godine zbog tadašnje svjetske gospodarske krize.


## BDP
```{r fig.height=3}
par(mfrow = c(1, 3), oma = c(0, 0, 2, 0))
hist(usa$gdp.growth.p, main="USA", xlab="rast %", col="deepskyblue")
hist(deu$gdp.growth.p, main="DEU", xlab="rast %", col="deepskyblue")
hist(grc$gdp.growth.p, main="GRC", xlab="rast %", col="deepskyblue")
mtext("Postotni rast BDP-a", outer = T, cex = 1.5, font = 2)


#boxplot(deu$gdp.mln_usd,
 #       usa$gdp.mln_usd,
  #      grc$gdp.mln_usd,
   #     names = c("DEU", "USA", "GRC"), main = "Sredine BDP-a",
    #    col = c("deepskyblue2", "deepskyblue3", "deepskyblue"),
     #   ylab = "mln USD (log skala)",
      #  log = "y")
```

Kao i kod uvoza i izvoza, po čistom BDP-u SAD značajno prednjači, dok je razlika između Njemačke i Grčke veća od one između SAD-a i Njemačke. No, ovaj prikaz možda nije mjerodavan što se tiče razvijenosti. Treba pogledati BDP po stanovniku:

```{r}
qqnorm(usa$gdp.growth.p)
qqline(usa$gdp.growth.p, col = "steelblue", lwd = 2)

qqnorm(deu$gdp.growth.p)
qqline(deu$gdp.growth.p, col = "steelblue", lwd = 2)

qqnorm(grc$gdp.growth.p)
qqline(grc$gdp.growth.p, col = "steelblue", lwd = 2)
```

```{r}
ggplot(na.omit(data.all), aes(x=country, y=gdp.growth.p)) +
  stat_boxplot(geom = "errorbar", width = 0.5) +
  geom_boxplot(aes(fill=country)) +
  labs(title = "Porast BDP-a", x="Država", y="Postotak", fill="Država") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))
```


```{r fig.height=3}
par(mfrow = c(1, 3), oma = c(0, 0, 2, 0))
hist(usa$gdp.pc.growth.p, main="USA", xlab="rast %", col="deepskyblue")
hist(deu$gdp.pc.growth.p, main="DEU", xlab="rast %", col="deepskyblue")
hist(grc$gdp.pc.growth.p, main="GRC", xlab="rast %", col="deepskyblue")
mtext("Postotni rast BDP-a po stanovniku", outer = T, cex = 1.5, font = 2)
#boxplot(deu$gdp.pc.usd_cap,
#        usa$gdp.pc.usd_cap,
#        grc$gdp.pc.usd_cap,
#        names = c("DEU", "USA", "GRC"), main = "Sredine BDP-a po stanovniku",
#        col = c("deepskyblue2", "deepskyblue3", "deepskyblue"),
#        ylab = " USD (log skala)",
#        log = "y")

```
Na prikazu BDP-a po stanovniku podaci su normaliziralni brojem stanovnika, razlike nisu toliko značajne, no SAD i dalje prednjači.

```{r}
plot(time, deu$gdp.growth, type = "h", main = "Rast BDP-a (DEU)")
plot(time, usa$gdp.growth, type="h", main = "Rast BDP-a (USA)")
plot(time, grc$gdp.growth, type="h", main = "Rast BDP-a (GRC)")

```
BDP Njemačke i SAD-a je u stalnom porastu uz fluktuacije, a jedini pad BDP-a koji primjećujemo vezan je uz gospodarsku krizu 2009. godine, kada primjećujemo i značajne padove u uvozu i izvozu. BDP Grčke ima veće fluktuacije i veća opadanja nakon 2009. godine. Rast BDP-ova po stanovniku bit će proporcionalan.

```{r}
ggplot(na.omit(data.all), aes(x=country, y=gdp.pc.growth.p)) +
  stat_boxplot(geom = "errorbar", width = 0.5) +
  geom_boxplot(aes(fill=country)) +
  labs(title = "Porast BDP-a po stanovniku", x="Država", y="Postotak", fill="Država") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))
```


## Testiranje hipoteza


#### Pretpostavka: Rast BDP-a po stanovniku značajno se razlikuje od rasta BDP-a neke države



#### Pretpostavka: Rast izvoza značajno je veći od rasta uvoza za neku državu

```{r}
library(reshape2)
exp.imp = melt(data.all, id.vars = "country", measure.vars = c("export.growth.p", "import.growth.p"), na.rm = T)
ggplot(exp.imp, aes(x = country, y = value, fill = variable)) +
  stat_boxplot(geom = "errorbar", width = 0.5, position = position_dodge(0.75)) +
  geom_boxplot() +
  labs(title = "Export/Import", y="Postotak") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))
```

Pogledom na gornji boxplot čini se da se uvoz i izvoz za neku državu ne razlikuju previše.
Jedinu značajniju razliku vidimo za USA. Provjerit ćemo je li to statistički značajno pomoću t-testa.

Postavit ćemo hipoteze:
\begin{align*}
  H_0: &
\end(align*)
